<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/app-storage/app-localstorage/app-localstorage-document.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">

<dom-module id="cart-data">

  <template>
<!--    <app-localstorage-document key="shop-cart-data" data="{{cart}}"></app-localstorage-document>-->
    <firebase-query
        id="queryCart"
        path="{{path}}"
        data="{{data}}">     
    </firebase-query>
<!--path="/carts/[[cartKey]]/itensCart"-->
  </template>

  <script>
    class CartData extends Polymer.Element {
        static get is() { return 'cart-data'; }
        static get properties() { return {
                data:{
                    type: Object,           
                    notify: true,                    
                    observer: '__dataChanged'
                },
            
                cartKey:{
                    type: String,
                    value: "",
                    observer: '_cartKeyChanged',                    
                },
            
                hasItens:{
                    type: Boolean,
                    value: false,
                    notify: true,
                    computed: '_computeHasItem(data.length)'
                },
            
                lastItemAdded:{
                    type: String,
                    notify: true
                },
            
                path:{
                    type: String,
                    readOnly: true
                },
                
                isReady:{
                  type: Boolean,
                  value: false,
                  notify: true,
                  readOnly: true
                }  
            }
        }
        
        _cartKeyChanged(value){
            
        }
        
        _formatCartKey(cartKey){
            
            return cartKey ? "/" + cartKey : "";
        }
        
        __dataChanged(value){
            if(this.data == null || Object.keys(this.data).length === 0){                
                this._setIsReady(false);
            }else{                    
                this._setIsReady(true);
            }
        }
        
        _computeHasItem(dataLength){
            return dataLength > 0;
        }
        
        _addCartItem(item){            
            this._setPath("/carts/-L2C2UQbfZ3aeHfK4CO-/itensCart");
            let cartRef = this.$.queryCart.ref;
            let key = cartRef.push(item);
        }
        
        _getItensCartData(){
            this._setPath("/carts/" + this.cartKey + "/itensCart");
        }
    }    
    customElements.define(CartData.is, CartData);
  </script>

</dom-module>